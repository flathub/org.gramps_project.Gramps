app-id: org.gramps_project.Gramps
# flatpak-builder will not take hyphen in com.gramps-project.Gramps
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: gramps
# to force an archive flatpak to use system locale instead of English. Not needed for flathub packages.
separate-locales: false
finish-args:
  - --filesystem=home
# for now, flathub rules blocking the data directories prevent users from choosing to go between a flatpak
# installation and a system installation. This can cause user data loss, even using persist instead of filesystem
# can cause data loss for users moving from the flatpak to a system install. When flathub changes thier rules, 
# home access can be removed and the below filesystems permissions can be used
#  - --filesystem=xdg-documents:create
#  - --filesystem=xdg-download
#  - --filesystem=xdg-pictures
# for data directories and compatibility with system installs, flathub currently blocks these directories
 # for databases started with 5.1 and earlier
#  - --filesystem=~/.gramps:create
 # for databases started with 5.2 system installations
#  - --filesystem=xdg-data:create
#  - --filesystem=xdg-config:create
#  - --filesystem=xdg-cache:create
# for gui
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
#needs network access for maps
  - --share=network
# set the environment for app when run
  - --env=PYTHONPATH=/app/plugins/site-packages
  - --env=GI_TYPELIB_PATH=/app/lib/girepository-1.0
  - --env=PYOVERRIDES_DIRECTORY=/app/lib/python3.13/site-packages/gi/overrides
build-options:
  env:
    PIP_PREFIX: /app
    PIP_DISABLE_PIP_VERSION_CHECK: "1"
    PYTHONPATH: /app/plugins/site-packages
    GI_TYPELIB_PATH: /app/lib/girepository-1.0
    PYOVERRIDES_DIRECTORY: /app/lib/python3.13/site-packages/gi/overrides
cleanup:
  - '*.a'
  - '*.la'
  - /include
  - /lib/pkgconfig
  - /share/aclocal
  - /lib/cmake
  - /share/gir-1.0
  - /share/man
modules:
# manifest below is for core Gramps dependencies
  - DepsCore.yml
# manifest below is for image and exiv metadata
  - DepsImages.yml
# manifest below is for Map related dependencies
  - DepsMaps.yml
# for network chart addon
  - DepsAddonNetworkChart.yml
# Gramps
  - name: Gramps
    buildsystem: simple
    build-commands:
      - pip3 install --no-build-isolation .
    sources:
      - type: archive
        url: https://github.com/gramps-project/gramps/archive/refs/tags/v6.0.6.tar.gz
        sha256: a1812a9b02e69dc49a9cdbc1b628f0af6c34115f5134d66f02e36f3fe75b2b77
